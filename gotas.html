---
layout: page
title: "Gotas de sombra"
permalink: /gotas-de-sombra/
---

<h2>Gotas de sombra</h2>
<p>Pensamientos que no caben en ningún otro sitio. Sin orden. Solo verdad.</p>

<div id="gotas-container">
  <div id="gotas-feed">Cargando gotas...</div>
  <div id="loading" style="display:none; text-align:center; padding:2em; color:#888;">
    <em>Cargando más gotas...</em>
  </div>
</div>

<script>
const repo = "KajiiNarumi/iasuarezv";
const perPage = 10;
let page = 1;
let loading = false;
let hasMore = true;

function escapeHtml(text) {
  if (!text) return "";
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function createGota(issue) {
  const div = document.createElement('div');
  div.className = 'gota-item fade-in';
  div.innerHTML = `
    <div class="gota-content">
      <h3>${escapeHtml(issue.title)}</h3>
      <div class="gota-body">${issue.body ? escapeHtml(issue.body).replace(/\n/g, '<br>') : ''}</div>
      <div class="gota-meta">
        <small>${new Date(issue.created_at).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</small>
      </div>
    </div>
  `;
  return div;
}

function loadMore() {
  if (loading || !hasMore) return;
  loading = true;
  document.getElementById('loading').style.display = 'block';

  fetch(`https://api.github.com/repos/${repo}/issues?state=all&per_page=${perPage}&page=${page}`)
    .then(r => r.json())
    .then(issues => {
      if (issues.length === 0) {
        hasMore = false;
        document.getElementById('loading').style.display = 'none';
        return;
      }

      const container = document.getElementById('gotas-feed');
      issues.forEach(issue => {
        container.appendChild(createGota(issue));
      });

      page++;
      loading = false;
      document.getElementById('loading').style.display = 'none';

      // Fade-in suave
      document.querySelectorAll('.gota-item.fade-in').forEach((el, i) => {
        setTimeout(() => el.classList.add('visible'), i * 100);
      });
    })
    .catch(err => {
      console.error(err);
      loading = false;
      document.getElementById('loading').innerHTML = '<em>Error al cargar. Intenta de nuevo.</em>';
    });
}

// Scroll infinito
window.addEventListener('scroll', () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
    loadMore();
  }
});

// Carga inicial
loadMore();
</script>

<style>
.gota-item {
  margin: 2em 0;
  padding: 1.5em;
  border-left: 3px solid #333;
  background: rgba(0,0,0,0.02);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
.gota-item.visible {
  opacity: 1;
  transform: translateY(0);
}
.gota-content h3 {
  margin: 0 0 0.8em 0;
  font-size: 1.3em;
  color: #000;
}
.gota-body {
  line-height: 1.7;
  margin-bottom: 0.8em;
}
.gota-meta {
  color: #666;
  font-style: italic;
}
</style>
