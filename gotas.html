---
layout: page
title: "Mis Gotas"
permalink: /gotas/
---

<h2>Fragmentos aforísticos</h2>

<!-- Loader animado -->
<div id="github-issues-feed">
  <div id="loader-gotas" style="display:flex;gap:1.2rem;justify-content:center;margin:2em 0;">
    <div class="gota"></div>
    <div class="gota"></div>
    <div class="gota"></div>
  </div>
</div>

<div id="github-pagination" style="margin-top:2em; text-align:center;"></div>

<style>
.gota {
  width: 14px;
  height: 14px;
  background: #999;
  border-radius: 50%;
  opacity: 0;
  animation: gotaFade 1.4s infinite ease-in-out;
}
.gota:nth-child(1) { animation-delay: 0s; }
.gota:nth-child(2) { animation-delay: 0.15s; }
.gota:nth-child(3) { animation-delay: 0.30s; }

@keyframes gotaFade {
  0% { opacity: 0; transform: scale(0.6); }
  50% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.6); }
}
</style>

<script>
const repo = "KajiiNarumi/iasuarezv";
const perPage = 10;
let currentPage = 1;

function escapeHtml(str) {
  if(!str) return "";
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function ocultarLoader() {
  const loader = document.getElementById("loader-gotas");
  if (loader) loader.style.display = "none";
}

function renderIssues(issues) {
  let html = "";
  
  if (issues.length === 0) {
    html = "<p>No hay notas aún.</p>";
  } else {
    issues.forEach(issue => {
      html += `
      <div class="note-issue" style="border:1px solid #eee; padding:1em; margin-bottom:2em;">
        <div>
          <img src="${issue.user.avatar_url}" alt="${issue.user.login}" style="width:32px;border-radius:50%;vertical-align:middle;">
          <strong>${escapeHtml(issue.user.login)}</strong>
          <span style="color:#888;">${new Date(issue.created_at).toLocaleString()}</span>
        </div>
        <h3 style="margin-top:0.5em;">${escapeHtml(issue.title)}</h3>
        <div>${issue.body ? escapeHtml(issue.body).replace(/\n/g,"<br>") : ""}</div>
        <div style="margin-top:1em;">
          <a href="${issue.html_url}" target="_blank">Comentar en GitHub</a>
        </div>
        <div class="issue-comments" id="comments-${issue.number}" style="margin-top:1em; font-size:0.9em; color:#444;">Cargando comentarios...</div>
      </div>
      `;
    });
  }

  document.getElementById('github-issues-feed').innerHTML = html;
}

function renderPagination(hasPrev, hasNext) {
  let html = "";

  if (hasPrev) {
    html += `<button onclick="loadIssues(${currentPage - 1})">&laquo; Anterior</button>`;
  }

  if (hasNext) {
    html += ` <button onclick="loadIssues(${currentPage + 1})">Siguiente &raquo;</button>`;
  }

  document.getElementById('github-pagination').innerHTML = html;
}

function loadIssues(page) {
  currentPage = page;

  document.getElementById('github-issues-feed').innerHTML = `
    <div id="loader-gotas" style="display:flex;gap:1.2rem;justify-content:center;margin:2em 0;">
      <div class="gota"></div>
      <div class="gota"></div>
      <div class="gota"></div>
    </div>
  `;

  fetch(`https://api.github.com/repos/${repo}/issues?state=open&per_page=${perPage}&page=${currentPage}`)
    .then(r => r.json())
    .then(issues => {

      ocultarLoader();
      renderIssues(issues);

      fetch(`https://api.github.com/repos/${repo}/issues?state=open&per_page=${perPage}&page=${currentPage + 1}`)
        .then(r => r.json())
        .then(nextIssues => {

          const hayMas = nextIssues.length > 0;
          const hayPrev = currentPage > 1;

          renderPagination(hayPrev, hayMas);

          if (!hayPrev && !hayMas) {
            document.getElementById('github-pagination').innerHTML = "";
          }
        });

      issues.forEach(issue => {
        fetch(`https://api.github.com/repos/${repo}/issues/${issue.number}/comments`)
          .then(r => r.json())
          .then(comments => {
            let html = "";

            if (comments.length === 0) {
              html = "<em>Sin comentarios.</em>";
            } else {
              html = "<ul style='list-style:none;padding:0;'>";
              comments.forEach(comment => {
                html += `
                <li style="margin-bottom:0.8em;">
                  <img src="${comment.user.avatar_url}" alt="${comment.user.login}" style="width:24px;border-radius:50%;vertical-align:middle;">
                  <strong>${escapeHtml(comment.user.login)}</strong>
                  <span style="color:#999;">${new Date(comment.created_at).toLocaleString()}</span>
                  <div>${escapeHtml(comment.body).replace(/\n/g,"<br>")}</div>
                </li>`;
              });
              html += "</ul>";
            }
            document.getElementById(`comments-${issue.number}`).innerHTML = html;
          });
      });
    });
}

window.loadIssues = loadIssues;
loadIssues(1);
</script>
