---
layout: page
title: "Mis Gotas"
permalink: /gotas/
---

<h2>Fragmentos aforísticos</h2>

<div id="github-issues-feed">Cargando notas...</div>
<div id="github-load-more" style="margin-top:2em; text-align:center;"></div>

<style>
.note-issue {
  border:1px solid #eee;
  padding:1em;
  margin-bottom:2em;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity .4s ease, transform .4s ease;
}
.note-issue.visible {
  opacity: 1;
  transform: translateY(0);
}
.load-btn {
  padding: 0.6em 1.1em;
  border: none;
  cursor: pointer;
  background: #ccc;
  font-size: 1em;
}
</style>

<script>
const repo = "KajiiNarumi/iasuarezv";
const perPage = 10;
let currentPage = 1;
let loading = false;
let noMore = false;

function escapeHtml(str) {
  if(!str) return "";
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function appendIssues(issues) {
  const container = document.getElementById('github-issues-feed');

  if (currentPage === 1) container.innerHTML = ""; // quita “Cargando notas…”

  if (issues.length === 0) {
    noMore = true;
    document.getElementById('github-load-more').innerHTML = "";
    return;
  }

  issues.forEach(issue => {
    let div = document.createElement("div");
    div.className = "note-issue";
    div.innerHTML = `
      <h3>${escapeHtml(issue.title)}</h3>
      <div>${issue.body ? escapeHtml(issue.body).replace(/\n/g,"<br>") : ""}</div>
    `;
    container.appendChild(div);

    // Activar transición
    setTimeout(() => div.classList.add("visible"), 50);
  });
}

function showLoadMoreButton() {
  if (noMore) {
    document.getElementById('github-load-more').innerHTML = "";
    return;
  }

  document.getElementById('github-load-more').innerHTML =
    `<button class="load-btn" onclick="loadIssues()">Cargar más</button>`;
}

function loadIssues(manual = false) {
  if (loading || noMore) return;
  loading = true;

  showLoadMoreButton(); // asegura el botón si falla autoscroll

  fetch(`https://api.github.com/repos/${repo}/issues?state=open&per_page=${perPage}&page=${currentPage}`)
    .then(r => r.json())
    .then(issues => {
      appendIssues(issues);

      if (issues.length < perPage) {
        noMore = true;
        document.getElementById('github-load-more').innerHTML = "";
      }

      currentPage++;
      loading = false;
    })
    .catch(() => {
      loading = false;
      showLoadMoreButton();
    });
}

// INFINITE SCROLL
window.addEventListener("scroll", () => {
  if (loading || noMore) return;

  const scrollPos = window.innerHeight + window.scrollY;
  const fullHeight = document.body.offsetHeight;

  if (scrollPos >= fullHeight - 400) {
    loadIssues();
  }
});

// Cargar primera página
loadIssues();
</script>
