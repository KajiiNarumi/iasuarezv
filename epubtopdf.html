<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Convertir EPUB a PDF</title>
<style>
  :root { --bg:#0b0c10; --card:#111318; --muted:#9aa3b2; --text:#e6e9ef; --accent:#7c9fff; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; background:var(--bg); color:var(--text); display:flex; flex-direction:column; align-items:center; min-height:100vh; padding:20px; }
  h1 { margin:0 0 12px; font-size: clamp(20px, 4vw, 28px); text-align:center; }
  p.sub { margin:0; color:var(--muted); text-align:center; margin-bottom:20px; }
  .card { background: var(--card); border:1px solid #1b1e25; border-radius:16px; padding:20px; max-width:600px; width:100%; }
  .uploader { display:flex; gap:16px; align-items:center; flex-wrap: wrap; justify-content:center; cursor:pointer; border:2px dashed #555; border-radius:12px; padding:20px; transition:0.3s; }
  .uploader.dragover { background:#1e1e1e; border-color:var(--accent); }
  .uploader input[type=file] { display:none; }
  .btn { display:inline-flex; align-items:center; gap:10px; padding:12px 20px; border-radius:12px; border:none; background:var(--accent); color:#0b0c10; cursor:pointer; font-weight:600; margin-top:12px; transition:0.3s; }
  .btn:hover { background:#99baff; }
  #status { margin-top:12px; color:var(--muted); font-size:14px; text-align:center; }
  footer { color:var(--muted); text-align:center; margin-top:40px; font-size:13px; }
</style>
</head>
<body>
<h1>üìñ Convertir EPUB a PDF</h1>
<p class="sub">Arrastra tu archivo EPUB o haz click para seleccionarlo. Se conservar√°n t√≠tulos, p√°rrafos e im√°genes.</p>

<div class="card">
  <label class="uploader" id="dropzone">
    Haz clic o arrastra tu EPUB aqu√≠
    <input type="file" id="fileInput" accept=".epub">
  </label>
  <button class="btn" id="convertBtn" disabled>Convertir a PDF</button>
  <div id="status"></div>
</div>

<footer>Hecho con cari√±o üíô ‚Äî 100% en tu navegador</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");
const convertBtn = document.getElementById("convertBtn");
const statusEl = document.getElementById("status");
let epubFile;

// Drag & Drop
dropzone.addEventListener("click", ()=>fileInput.click());
dropzone.addEventListener("dragover", e => { e.preventDefault(); dropzone.classList.add("dragover"); });
dropzone.addEventListener("dragleave", ()=>dropzone.classList.remove("dragover"));
dropzone.addEventListener("drop", e => { e.preventDefault(); dropzone.classList.remove("dragover"); handleFile(e.dataTransfer.files[0]); });
fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

function handleFile(file){
  if(!file || !file.name.endsWith(".epub")) return;
  epubFile = file;
  statusEl.textContent = `Archivo seleccionado: ${file.name}`;
  convertBtn.disabled = false;
}

// Conversi√≥n
convertBtn.addEventListener("click", async ()=>{
  if(!epubFile) return;
  statusEl.textContent = "Procesando EPUB... esto puede tardar";

  const zip = await JSZip.loadAsync(await epubFile.arrayBuffer());
  const chapters = [];

  for(const filename of Object.keys(zip.files)){
    if(filename.endsWith(".xhtml") || filename.endsWith(".html")){
      const content = await zip.file(filename).async("string");
      chapters.push(content);
    }
  }

  if(!chapters.length){
    statusEl.textContent = "No se encontraron cap√≠tulos legibles";
    return;
  }

  statusEl.textContent = "Generando PDF... esto puede tardar un momento";

  // Crear contenedor temporal para html2pdf
  const container = document.createElement("div");
  container.style.padding="20px"; container.style.color="#000"; container.style.background="#fff"; container.style.fontFamily="serif";
  document.body.appendChild(container);

  for(const chapter of chapters){
    const chapterDiv = document.createElement("div");
    chapterDiv.innerHTML = chapter;
    chapterDiv.style.pageBreakAfter = "always";
    container.appendChild(chapterDiv);
  }

  // Config html2pdf
  const opt = {
    margin:       [20,20,20,20],
    filename:     epubFile.name.replace(".epub",".pdf"),
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2, logging: false },
    jsPDF:        { unit: 'pt', format: 'a4', orientation: 'portrait' }
  };

  await html2pdf().set(opt).from(container).save();
  container.remove();
  statusEl.textContent = "Conversi√≥n completada ‚úÖ";
});
</script>
</body>
</html>
